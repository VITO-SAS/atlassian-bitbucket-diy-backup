#------------------------------------------------------------------------------------------
# Sample bitbucket.diy-backup.vars.sh pre-configured for PostgreSQL and RSync.
# 
# This sample vars file serves as a starting point for customers running Bitbucket Server
# with a PostgreSQL database and using RSync for filesystem backup.
# Backups are archived using Tar and Gzip
#
# Using rsync to back up the home directory is portable to most file system technologies, but requires some
# downtime during backup to ensure consistency of Git repositories.
# See https://confluence.atlassian.com/display/BitbucketServer/Data+recovery+and+backups for more information.
#
# For a detailed description of each variable consult the master bitbucket.diy-backup.vars.sh.example file.
#------------------------------------------------------------------------------------------

INSTANCE_NAME=jira
BITBUCKET_URL=https://jira-diy-backup.deplops.com

BITBUCKET_HOME=/var/atlassian/application-data/bitbucket/
BITBUCKET_UID=jira
BITBUCKET_GID=jira

BACKUP_DISK_TYPE=rsync
BACKUP_DATABASE_TYPE=postgresql
BACKUP_ARCHIVE_TYPE=tar

# The admin user and password for the Bitbucket instance
BITBUCKET_BACKUP_USER=admin
BITBUCKET_BACKUP_PASS=j1raadm1nd

BITBUCKET_BACKUP_EXCLUDE_REPOS=()

# PostgreSQL configuration
BITBUCKET_DB=jira
POSTGRES_HOST=localhost
POSTGRES_USERNAME=atljira
export PGPASSWORD=Postgres1%
POSTGRES_PORT=5432

# Make use of PostgreSQL 9.3+ options if available
psql_version="$(psql --version | awk '{print $3}')"
psql_majorminor="$(printf "%d%03d" $(echo "${psql_version}" | tr "." "\n" | sed 2q))"
if [[ ${psql_majorminor} -ge 9003 ]]; then
    PG_PARALLEL="-j 5"
    PG_SNAPSHOT_OPT="--no-synchronized-snapshots"
fi

# The path to working folder for the backup
BITBUCKET_BACKUP_ROOT=/var/atlassian/jira-backup
BITBUCKET_BACKUP_DB=${BITBUCKET_BACKUP_ROOT}/jira-db/
BITBUCKET_BACKUP_HOME=${BITBUCKET_BACKUP_ROOT}/jira-home/

# The path to where the backup archives are stored
BITBUCKET_BACKUP_ARCHIVE_ROOT=/var/atlassian/backup-archive

CURL_OPTIONS="-L -s -f"
BITBUCKET_VERBOSE_BACKUP=true